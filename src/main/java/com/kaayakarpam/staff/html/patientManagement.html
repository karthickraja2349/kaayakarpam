<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaayakarpam - Patient Requests</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
            body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f6f9;
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
     nav {
      width: 240px;
      background-color: #2c3e50;
      padding: 20px 10px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }

    nav h2 {
      color: #ecf0f1;
      text-align: center;
      margin-bottom: 25px;
      font-size: 22px;
      margin-top:15px;
      margin-left : 20px;
    }

    nav a {
      display: flex;
      align-items: center;
      color: #ecf0f1;
      text-decoration: none;
      margin: 6px 0; /* Reduced from 12px to 6px */
    padding: 8px 12px; /* Reduced padding from 10px to 8px */
      border-radius: 6px;
      transition: 0.3s;
      font-size: 15px;
    }

    nav a i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    nav a:hover {
      background-color: #1abc9c;
      color: #fff;
    }


        
        body {
            background-color: #f5f7f9;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #0066cc 0%, #003366 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .card-title {
            font-size: 1.5rem;
            color: #0066cc;
        }
        
        .refresh-btn {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .refresh-btn:hover {
            background-color: #0055aa;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            min-width: 900px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-allocated {
            background-color: #d4edda;
            color: #155724;
        }
        
        .action-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .form-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
        }
        
        .submit-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .submit-btn:hover {
            background-color: #218838;
        }
        
        .transfer-btn {
            background-color: #ffc107;
            color: #212529;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 5px;
        }
        
        .transfer-btn:hover {
            background-color: #e0a800;
        }
        
        .no-requests {
            text-align: center;
            padding: 30px;
            color: #6c757d;
        }
        
       .error-message, .success-message {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px;
        border-radius: 5px;
        z-index: 10000;
        display: none;
        max-width: 300px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .error-message {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    .success-message {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .logout-btn:hover {
            background-color: #c82333;
        }
        
        .timer-cell {
            font-family: monospace;
            font-weight: bold;
        }
        
        .timer-critical {
            color: #dc3545;
        }
        
        .timer-warning {
            color: #ffc107;
        }
        
        /* Transfer Section Styles */
        .transfer-section {
            display: none;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .transfer-form {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .transfer-submit-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .transfer-submit-btn:hover {
            background-color: #138496;
        }
        
        .transfer-cancel-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 10px;
        }
        
        .transfer-cancel-btn:hover {
            background-color: #5a6268;
        }
        
        .hospitals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .hospital-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            transition: transform 0.2s;
        }
        
        .hospital-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .hospital-name {
            font-size: 1.2rem;
            color: #0066cc;
            margin-bottom: 10px;
        }
        
        .hospital-detail {
            margin-bottom: 8px;
            display: flex;
        }
        
        .detail-label {
            font-weight: 600;
            min-width: 100px;
        }
        
        .select-hospital-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        .select-hospital-btn:hover {
            background-color: #138496;
        }
        
        .main {
      flex: 1;
      display: block;
      flex-direction: column;
      min-height: 100vh;
    }
        
        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
            }
            
            .action-form {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .transfer-buttons {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .transfer-cancel-btn {
                margin-left: 0;
            }
            
            .hospitals-grid {
                grid-template-columns: 1fr;
            }
            
        }
    </style>
</head>
<body>
    <nav>
    <h2><i class="fa-solid fa-user-shield"></i> Staff Panel</h2>
    <a href="/kaayakarpam/index.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
     <a href="../jsp/staffView.jsp"><i class="fa fa-clipboard" aria-hidden="true"></i> DashBoard</a>
    <a href="../html/viewInPatients.html"><i class="fa-solid fa-bed"></i> View InPatients</a>
    <a href="../html/viewHospitalDetails.html"><i class="fa-solid fa-hospital"></i> Hospital Details</a>
    <a href="../html/viewScanAppointments.html"><i class="fa fa-calendar" aria-hidden="true"></i> Today Scan Appointments </a>
    <a href="../html/viewUpcomingScanAppointments.html"><i class="fas fa-hourglass"></i> Upcoming Scan Appointments </a>
    <a href="../html/scanAppointmentsHistory.html"><i class="fas fa-hourglass-end"></i> Scan Appointments History</a>
    <a href="../html/patientManagement.html"><i class="fa-solid fa-file-medical"></i> Patient Requests</a>
     <a href="../../common/web/html/viewProfile.html"><i class="fa-solid fa-user"></i> View Profile</a>
  </nav>
  <div class = "main">
    <div class="header">
        <h1>Patient Requests Management</h1>
       <!-- <p>Hospital Staff Dashboard</p>-->
       <!-- <button class="logout-btn" onclick="logout()">Logout</button> -->
    </div>
    
    <div class="container">
        <div id="error-message" class="error-message"></div>
        <div id="success-message" class="success-message"></div>
        
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Pending Patient Requests</h2>
                <button class="refresh-btn" onclick="loadRequests()">Refresh</button>
            </div>
            
            <div id="requests-table">
                <table>
                    <thead>
                        <tr>
                            <th>Request ID</th>
                            <th>Request Type</th>
                            <th>Bed Allocated</th>
                            <th>Request Time</th>
                            <th>Time Waiting</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="requests-body">
                        
                    </tbody>
                </table>
            </div>
            
            <div id="no-requests" class="no-requests" style="display: none;">
                <p>No pending patient requests at this time.</p>
            </div>
        </div>
        
        <!-- Transfer Section -->
        <div id="transfer-section" class="card transfer-section">
            <div class="card-header">
                <h2 class="card-title">Patient Transfer - Request #<span id="transfer-request-id"></span></h2>
                <button class="transfer-cancel-btn" onclick="cancelTransfer()">Cancel Transfer</button>
            </div>
            
            <div id="transfer-data">
                <h3>Nearby Hospitals</h3>
                <p>Select a hospital to transfer this patient to:</p>
                
                <div id="hospitals-container" class="hospitals-grid">
                   
                </div>
            </div>
            
            <div class="transfer-form">
                <h3>Initiate Transfer to: <span id="selected-hospital-name"></span></h3>
                <input type="hidden" id="selected-hospital-id">
                
                <form id="transfer-form" onsubmit="submitTransfer(event)">
                    <div class="form-group">
                        <label class="form-label" for="transfer-reason">Transfer Reason:</label>
                        <textarea id="transfer-reason" class="form-input" required placeholder="Enter reason for transfer" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="patient-condition">Patient Condition Notes:</label>
                        <textarea id="patient-condition" class="form-input" placeholder="Any additional notes about patient condition" rows="3"></textarea>
                    </div>
                    <button type="submit" class="transfer-submit-btn">Confirm Transfer</button>
                    <button type="button" class="transfer-cancel-btn" onclick="cancelHospitalSelection()">Change Hospital</button>
                </form>
            </div>
        </div>
    </div>
   </div>
    <script>
        // Global variables
        let hospitalId = null;
        let timers = {}; // Object to store interval IDs for each timer
        let requestsData = []; // Store requests data for timer calculations
        let currentTransferRequestId = null; // Track which request is being transferred
        let nearbyHospitals = []; // Store nearby hospitals data
        
        // Load patient requests
        async function loadRequests() {   
            try {
                //showMessage('Loading requests...', 'success');
                const response = await fetch('/kaayakarpam/patientRequest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const requests = await response.json();
                    requestsData = requests; // Store the data
                    displayRequests(requests);
                } 
                else {
                    showError('Failed to load patient requests');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }
        
        // Display requests in the table
        function displayRequests(requests) {
            const requestsBody = document.getElementById('requests-body');
            const noRequests = document.getElementById('no-requests');
            const requestsTable = document.getElementById('requests-table');
            
            requestsBody.innerHTML = '';
            
            // Clear all existing timers
            for (let id in timers) {
                clearInterval(timers[id]);
            }
            timers = {};
            
            if (requests.length === 0) {
                requestsTable.style.display = 'none';
                noRequests.style.display = 'block';
                return;
            }
            
            requestsTable.style.display = 'table';
            noRequests.style.display = 'none';
            
            requests.forEach(request => {
                const row = document.createElement('tr');
                const requestTime = new Date(request.request_time);
                const timeWaitingId = `time-waiting${request.temporary_request_id}`;
                
                row.innerHTML = `
                    <td>${request.temporary_request_id}</td>
                    <td>${request.request_type}</td>
                    <td>
                        <span class="status-badge ${request.isBedAllocated ? 'status-allocated' : 'status-pending'}">
                            ${request.isBedAllocated ? 'Allocated' : 'Pending'}
                        </span>
                    </td>
                    <td>${requestTime.toLocaleString()}</td>
                    <td id="${timeWaitingId}" class="timer-cell">Calculating...</td>
                    <td>
                        ${!request.isBedAllocated ? 
                            `<button class="submit-btn" onclick="allocateBed(${request.temporary_request_id})">
                                Allocate Bed
                            </button>` : 
                            'Allocated'
                        }
                        <button class="transfer-btn" onclick="initiateTransfer(${request.temporary_request_id})">
                            Transfer
                        </button>
                    </td>
                `;
                
                requestsBody.appendChild(row);
                
                // Start timer for this request if not allocated
                if (!request.isBedAllocated) {
                    startTimer(request.temporary_request_id, requestTime, timeWaitingId);
                } else {
                    document.getElementById(timeWaitingId).textContent = "Completed";
                }
            });
        }
        
        // Start a timer for a request
        function startTimer(requestId, requestTime, elementId) {
            // Calculate initial time difference
             
            updateTimerDisplay(requestId, requestTime, elementId);
            
            // Set interval to update timer every second
            timers[requestId] = setInterval(() => {
                updateTimerDisplay(requestId, requestTime, elementId);
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay(requestId, requestTime, elementId) {
            const now = new Date();
            const diffMs =  requestTime - now;
        //  const diffMs  = now - requestTime;
            // const diffMs = Math.max(0, now - new Date(requestTime));
            const diffSec = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSec / 60);
            const diffHrs = Math.floor(diffMins / 60);
            
            // Format time as HH:MM:SS
            const hours = diffHrs;
            const minutes = diffMins % 60;
            const seconds = diffSec % 60;
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById(elementId);
            
             if (!timerElement) {
        console.error(`Timer element with id "${elementId}" not found`);
        return;
    }
            timerElement.textContent = timeString;
            
            // Add warning classes based on time
            if (hours >= 2) {
                timerElement.className = 'timer-cell timer-critical';
            } else if (hours >= 1) {
                timerElement.className = 'timer-cell timer-warning';
            } else {
                timerElement.className = 'timer-cell';
            }
        }
        
        async function allocateBed(requestId) {
    // Stop the timer for this request
    if (timers[requestId]) {
        clearInterval(timers[requestId]);
        delete timers[requestId];
    }
    
    try {
        const response = await fetch('/kaayakarpam/bedAllocation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                temporary_request_id: requestId
            })
        });
        
        // First check if response is OK (status 200-299)
        if (response.ok) {
            try {
                const result = await response.json();
                showSuccess(result.message || 'Bed allocated successfully');
                loadRequests(); // Refresh the requests list
            } catch (e) {
                // If JSON parsing fails, try text
                const text = await response.text();
                showSuccess(text || 'Bed allocated successfully');
                loadRequests();
            }
        } 
        else if (response.status === 409) { // Handle no bed available case
            try {
                const errorData = await response.json();
                 console.log('409 error received:', errorData);
                showError(errorData.message || 'No beds available');
            } catch (e) {
                 console.log('409 error (text):', text);
                const text = await response.text();
                showError(text || 'No beds available');
            }
            // Restart the timer since allocation failed
            const request = requestsData.find(r => r.temporary_request_id === requestId);
            if (request) {
                const timeWaitingId = `time-waiting-${requestId}`;
                startTimer(requestId, new Date(request.request_time), timeWaitingId);
            }
        }
        else {
            showError('Failed to allocate bed. Status: ' + response.status);
            // Restart the timer if allocation failed
            const request = requestsData.find(r => r.temporary_request_id === requestId);
            if (request) {
                const timeWaitingId = `time-waiting-${requestId}`;
                startTimer(requestId, new Date(request.request_time), timeWaitingId);
            }
        }
    } catch (error) {
        showError('Network error: ' + error.message);
        // Restart the timer if allocation failed
        const request = requestsData.find(r => r.temporary_request_id === requestId);
        if (request) {
            const timeWaitingId = `time-waiting-${requestId}`;
            startTimer(requestId, new Date(request.request_time), timeWaitingId);
        }
    }
}
        
     /*   // Allocate bed for a request
        async function allocateBed(requestId) {
            // Stop the timer for this request
            if (timers[requestId]) {
                clearInterval(timers[requestId]);
                delete timers[requestId];
            }
            
            try {
                const response = await fetch('/kaayakarpam/bedAllocation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        temporary_request_id: requestId
                    })
                });
                const responseText = await response.text();
        
                const result = JSON.parse(responseText);
                if (response.status === 200) {
                   // const result = await response.json();
                    showSuccess(result.message || 'Bed allocated successfully');
                    loadRequests(); // Refresh the requests list
                } 
                else if (response.status === 409) { // Handle no bed available case
                    const errorData = await response.json();
                    showError(errorData.message || 'No beds available');
                    // Restart the timer since allocation failed
                    const request = requestsData.find(r => r.temporary_request_id === requestId);
                    if (request) {
                        const timeWaitingId = `time-waiting-${requestId}`;
                        startTimer(requestId, new Date(request.request_time), timeWaitingId);
                    }
             }
                else {
                    showError('Failed to allocate bed');
                    // Restart the timer if allocation failed
                    const request = requestsData.find(r => r.temporary_request_id === requestId);
                    if (request) {
                        const timeWaitingId = `time-waiting-${requestId}`;
                        startTimer(requestId, new Date(request.request_time), timeWaitingId);
                    }
                }
            } catch (error) {
                showError('Network error: ' + error.message);
                // Restart the timer if allocation failed
                const request = requestsData.find(r => r.temporary_request_id === requestId);
                if (request) {
                    const timeWaitingId = `time-waiting-${requestId}`;
                    startTimer(requestId, new Date(request.request_time), timeWaitingId);
                }
            }
        }
        */
        
        // Initiate transfer process
        async function initiateTransfer(requestId) {
            currentTransferRequestId = requestId;
            
            try {
                // Show loading state
                document.getElementById('hospitals-container').innerHTML = '<p>Loading nearby hospitals...</p>';
                document.getElementById('transfer-request-id').textContent = requestId;
                document.getElementById('transfer-section').style.display = 'block';
                
                // Scroll to the transfer section
                document.getElementById('transfer-section').scrollIntoView({ behavior: 'smooth' });
                
                // Fetch transfer data via GET request
                const response = await fetch(`/kaayakarpam/patientTransfer?requestId=${requestId}`, {
                    method: 'GET'
                });
                
                if (response.ok) {
                    const hospitalsData = await response.json();
                    nearbyHospitals = hospitalsData;
                    
                    // Display the hospitals
                    displayHospitals(hospitalsData);
                    
                } else {
                    showError('Failed to fetch nearby hospitals data');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }
        
        // Display hospitals in the transfer section
        function displayHospitals(hospitals) {
            const hospitalsContainer = document.getElementById('hospitals-container');
            
            if (hospitals.length === 0) {
                hospitalsContainer.innerHTML = '<p>No nearby hospitals found.</p>';
                return;
            }
            
            hospitalsContainer.innerHTML = '';
            
            hospitals.forEach(hospital => {
                const hospitalCard = document.createElement('div');
                hospitalCard.className = 'hospital-card';
                
                hospitalCard.innerHTML = `
                    <h3 class="hospital-name">${hospital.hospitalName}</h3>
                    <div class="hospital-detail">
                        <span class="detail-label">Address:</span>
                        <span>${hospital.hospitalAddress}</span>
                    </div>
                    <div class="hospital-detail">
                        <span class="detail-label">Phone:</span>
                        <span>${hospital.hospitalPhoneNumber}</span>
                    </div>
                    <button class="select-hospital-btn" onclick="selectHospital(${hospital.hospitalId}, '${hospital.hospitalName}')">
                        Select This Hospital
                    </button>
                `;
                
                hospitalsContainer.appendChild(hospitalCard);
            });
        }
        
        // Select a hospital for transfer
        function selectHospital(hospitalId, hospitalName) {
            document.getElementById('selected-hospital-id').value = hospitalId;
            document.getElementById('selected-hospital-name').textContent = hospitalName;
            
            // Show the transfer form
            document.querySelector('.transfer-form').style.display = 'block';
            
            // Scroll to the form
            document.querySelector('.transfer-form').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Cancel hospital selection
        function cancelHospitalSelection() {
            document.getElementById('selected-hospital-id').value = '';
            document.getElementById('selected-hospital-name').textContent = '';
            document.querySelector('.transfer-form').style.display = 'none';
        }
        
        // Submit transfer form
        async function submitTransfer(event) {
            event.preventDefault();
            
            if (!currentTransferRequestId) {
                showError('No transfer request selected');
                return;
            }
            
            const hospitalId = document.getElementById('selected-hospital-id').value;
            if (!hospitalId) {
                showError('Please select a hospital first');
                return;
            }
            
            const transferReason = document.getElementById('transfer-reason').value;
            const patientCondition = document.getElementById('patient-condition').value;
            
            try {
                const response = await fetch('/kaayakarpam/patientTransfer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        requestId: currentTransferRequestId,
                        destinationHospitalId: hospitalId,
                        reason: transferReason,
                        patientCondition: patientCondition
                    })
                });
                 const result = await response.json();
                if (response.ok) {
                  //  const result = await response.text();
                    showSuccess('Transfer initiated successfully: ' );
                    
                    // Reset the form and hide transfer section
                    cancelTransfer();
                    
                    // Refresh requests
                    loadRequests();
                } else {
                    //('Failed to initiate transfer');
                           if (result.error && result.error.includes("Already Bed was Allocated")) {
                                  showError('Bed Already Allocated',  'A bed has already been allocated for this patient at your hospital. ' +
                                              'Transfer cannot be initiated. Please contact administration if this is incorrect.');
                          } 
                          else {
                               showError('Failed to initiate transfer: ' + (result.error || 'Unknown error'));
                          }
                }
            } 
            catch (error) {
                showError('Network error: ' + error.message);
            }
        }
        
        // Cancel transfer process
        function cancelTransfer() {
            document.getElementById('transfer-section').style.display = 'none';
            document.getElementById('transfer-form').reset();
            document.querySelector('.transfer-form').style.display = 'none';
            currentTransferRequestId = null;
            nearbyHospitals = [];
        }
        
      /*  // Show error message
        function showError(message) {
             console.log("ERROR:", message);
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }*/

function showError(message) {
    console.log("ERROR:", message);
    const errorDiv = document.getElementById('error-message');
    if (!errorDiv) {
        console.error("Error div not found");
        return;
    }
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';

    setTimeout(() => {
        errorDiv.style.display = 'none';
    }, 5000);
}

        
        // Show success message
        function showSuccess(message) {
             console.log("SUCCESS:", message); 
            const successDiv = document.getElementById('success-message');
            console.log("Success div element:", successDiv);
              if (successDiv) {
        console.log("Current display style:", window.getComputedStyle(successDiv).display);
        console.log("Current visibility style:", window.getComputedStyle(successDiv).visibility);
        console.log("Current opacity:", window.getComputedStyle(successDiv).opacity);
        console.log("Current z-index:", window.getComputedStyle(successDiv).zIndex);
    }
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }
        
        // Show message (no specific type)
        function showMessage(message, type) {
            const messageDiv = document.getElementById(`${type}-message`);
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            // Hide after 3 seconds
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
        
        // Logout function
        function logout() {
            // Clear all timers
            for (let id in timers) {
                clearInterval(timers[id]);
            }
            
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userRole');
            localStorage.removeItem('hospitalId');
            window.location.href = '/kaayakarpam/login.html';
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadRequests();
        });
    </script>
</body>
</html>
